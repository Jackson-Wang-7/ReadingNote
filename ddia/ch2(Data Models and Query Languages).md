# 第二章 数据模型和查询语言

## 关系模型与文档模型
关系模型：数据被组织成 关系（SQL 中称作 表），其中每个关系是 元组（SQL 中称作 行) 的无序集合。常应用于事务处理和批处理。

如果数据存储在关系表中，那么需要一个笨拙的转换层。模型之间的不连贯有时被称为阻抗不匹配（impedance mismatch）。应用有对象关系映射（ORM object-relational mapping） 框架。

Json和xml一定程度上减少了对象关系的不匹配，尤其是对文档数据的处理。

规范化的理想结果是多对一的关系。（许多人生活在一个特定的地区，许多人在一个特定的行业）这和文档模型又有冲突。在关系数据库中，通过 ID 来引用其他表中的行是正常的，因为连接很容易。在文档数据库中，一对多树结构没有必要用连接，对连接的支持通常很弱。随着业务扩展，连接可以解决更多的问题，也能更加简化模型。如果数据库本身不支持连接，则必须在应用程序代码中通过对数据库进行多个查询来模拟连接。

取舍：如果application中的数据具有文档的结果（一对多关系树），建议使用文档模型。
如果application确实会用到多对多关系，那么文档模型就不适合。尽管可以通过反规范化或增加应用代码来解决连接的问题，但是复杂性也转移到了应用程序中而且性能更差。

文档数据库有时称为 无模式（schemaless），但这具有误导性，因为读取数据的代码通常假定某种结构 —— 即存在隐式模式，但不由数据库强制执行。一个更精确的术语是 读时模式（即 schema-on-read，数据的结构是隐含的，只有在数据被读取时才被解释），相应的是 写时模式（即 schema-on-write，传统的关系数据库方法中，模式明确，且数据库确保所有的数据都符合其模式）。


## 数据查询语言
关系模型包含了一种查询数据的新方法：SQL 是一种 声明式 查询语言，而 IMS 和 CODASYL 使用 命令式 代码来查询数据库。

命令式语言告诉计算机以特定顺序执行某些操作。可以想象一下，逐行地遍历代码，评估条件，更新变量，并决定是否再循环一遍。

在声明式查询语言（如 SQL 或关系代数）中，你只需指定所需数据的模式 - 结果必须符合哪些条件，以及如何将数据转换（例如，排序，分组和集合） - 而不是如何实现这一目标。


## 图数据模型

如果多对多的关系在数据中很常见，将数据建模为图形会更自然。

一个图由两种对象组成：顶点（vertices,nodes,entities）和边（edges,relationships,arcs）。

有几种不同但相关的方式可以用来构建和查询图表中的数据。主要讨论属性图模型和三元组存储模型



## 总结：

1. 关系型数据库更适合结构确定性的场景，部分数据之间存在有联系
2. 文档数据库 的应用场景是：数据通常是自我包含的，而且文档之间的关系非常稀少。
3. 图形数据库 用于相反的场景：任意事物都可能与任何事物相关联。
